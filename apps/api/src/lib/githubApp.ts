// apps/api/src/lib/githubApp.ts
import { App } from '@octokit/app';
import { createAppAuth } from '@octokit/auth-app';
import { Octokit } from '@octokit/rest';
import { config } from 'dotenv';
// Load environment variables
config({
  path: '../../.env'
});

console.log(process.env.GITHUB_APP_ID, "here is the key")
const GITHUB_APP_ID=1636950
const GITHUB_PRIVATE_KEY_BASE64="LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBd2F3aGZLRHBVUHhZTUlHbGo1UWtrTHlXc3lkenpuUnNSalFMZHExalVXdDFMU2kwCjVCbE91dCtzVFFuekdNQzdlS3JsckpseUpqQi9BWXlibVVkaGJTVFYzTlpBMzF6TDhYdkpBWitzYUd2cEdEcEkKeExLREp6b21TbC93WHh0U1ZrdXJDUHJLNS84REhZcFdrdjBNcU5kYU5jVkl6by9lbDN4ZzV6NW01MlBVMXJwNgppaVZSZG9BR2plSHU3dGI4RFNXV2diNmFIZTdNQS9nM1Nib29DNUlhWUtsc29RSnJkN0l5MTljSTlxcHg3RUpUCm12ajlEbW11QVhCbU11ZVN4QjRnNUZVVmU2WXhUaVRUWHpyaTFtU2xzUmZ0N2R3SjlGa05TNWZ2ZHFTcXB3azQKeGEzVlZLZkJJOWIyRGdNZkJFenFxZUM5NFowZ05LYUhlenh1d1FJREFRQUJBb0lCQVFDU1UrZUpMbHFhSWM3UAo5MlNMc3JaZDFOOVh4UHN1aGJBNDZxR3VyUnBaTGdOK2R6OFZDRG4vMzNkalRaMHFtcFFLZTdURVQ3dDdOekQrCmpxb1JpV2tHK2NuTDdPVmUzZElKUmlsODNKTjY0ZTFmck1uR004bjhIV2RJMG12ZXI5bnA4WW5zWXZCamtMMWQKMkdQSTh3QlpvVHc3WEMvQ1FkbEFRMjFEeWxZZGhISnlEWnc0VTBRejdEd0k3cldVWTBOblQ4WVdEQUJXWkQyegprTEpiQTlTTHYwME9TL29sMUV2UlJIcWVpUVVSRURhSkt2T2tyM3VNTzFBTmtlTmFweHpaRWJPMkFiVnc3SGhsCk9DdUhrYUhWeFJDUml4SDBweDVnWkZOTVRHZ2dnM096bkt1dmxlZk1EaThhR210byttcDArWEp2L1Rrei9hT28KU05Va3o5T3hBb0dCQVBISFl5dGtib3B1ZmMxVTY5bFpDQ0k5eVU1SXkwdUJhaFNrTVN3eHhNV2hCeGFDamRxcApKMzJVUkU3a09QZXVZTk4vNGhuVUpoeHJ2Rk56TldkWjFXSGRQRlcvREdINmczYWVRRHIzcUgweHpNNGMzTDU4Ck5Idjl1WGlFWmx6cjl2cHFsUFNZSmFuL2poWkJCcjUvOUFiVHZ6QnpENXFLNXhnWis3NmN0ZXZQQW9HQkFNMFEKWC9FVmRrWHpJOTdTeVhiVC9TenVWL2t4cms0L1dlaG9hTkNDRS9PM283bEpYdGNzNkd6R0g3aE5CUTZQLy9WRgo0ZUxoWWJHUm56VCs3V3RhbysxRzJIWjJPQWtyT0dVdnZDUVp2dzhaZG1rc3VvNmk0M01LVVU3cXpuTTZKdW9mCjlIZG12dW0wUFZNVGtjRkp2aTBFaS9PeWx2QVdRY1Q4cmFiY3pkQnZBb0dCQUlDb016TlIvQ2laNTBPdVh0cUgKci9aWW5waVR6K3BiOFZFT2xrUUlMOGRpaXQwRmwrcTFmSmdzbjdURGFUVVRpOTYvL0ZiMk4xbUVVdkN0Szh2VgpWK0Q5MHk5bHZIY2UwWG43ZC81bzd6Vy9uRlpKc1lXRG5vSWtYOStyeExUSnMrRkplZjQyUUVTWUFzb0F6RS91CjBySVhWM08ycHFUOEtVRUFBcUJKejl5dEFvR0FFSHZFZW9pVEhVUlNHZE12eHBGN3hHVFVSWCtzMXpWWWNNb1QKd3M3eDg2RkxVOVdGL2gzcUFQUmNFR0NBaTQ4ZnNBT1NDTDY5TDV6WkExV0ttQnFOR3NHYkhNcWI3b0MrNDhOVwppRUJaajBrb3I0T2M2MkpFampiQ0dtbmRkbjJ5S3hldWV2cVRWZzNhOEJhZW5MN2t2cEdpL2svWXVpdlAxWm5LCkM2T3NGNWtDZ1lFQTFSTGFYZ1B4Q096clRUeUlMUGhPcDRkY25oUEhjTkNUcHNwbnZxTllXbDlOZlRYbkhIbUkKcm9zR21VWElZUWQweHU3WjRrUVdleFR1VTR0emthUmdyU0tCekg1a1FaMEZiWkp6RVp4Q2d4c3RUVVoybHZpbAp6ZkRMK0UxdHJWSUMrS3ZIM0JPNHhFWUNESWh2akgzdTNwWDFPRWw2VmhYbWxRS0hPZjhua2JRPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="
const GITHUB_WEBHOOK_SECRET="sdhfjkasdhfjkh"

// Initialize GitHub App
export const octokitApp = new App({
  appId: GITHUB_APP_ID,
  privateKey: Buffer.from(GITHUB_PRIVATE_KEY_BASE64, 'base64').toString('utf8'),
  webhooks: {
    secret: GITHUB_WEBHOOK_SECRET
  }
});

// Create authenticated Octokit instance for an installation
export const getInstallationOctokit = (installationId: number): Octokit => {
  return new Octokit({
    authStrategy: createAppAuth,
    auth: {
      appId: GITHUB_APP_ID,
      privateKey: Buffer.from(GITHUB_PRIVATE_KEY_BASE64, 'base64').toString('utf8'),
      installationId
    }
  });
};